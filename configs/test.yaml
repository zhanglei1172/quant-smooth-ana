# Default configuration for Quant Smooth Ana

# Model configuration
model:
  path: "/dataset/workspace/zhangl98/models/Qwen3-0.6B/"
  name: "Qwen3-0.6B"
  family: "qwen"  # llama, qwen, mistral, etc.
  hf_token: null

# Data configuration
data:
  source: "pile"  # pile, wikitext2, c4, redpajama, hf:dataset_name, custom:/path/to/file
  num_samples: 1
  seq_len: 256
  seed: 0
  # Custom dataset configuration
  custom:
    format: "text"  # text, json, csv
    text_column: "text"  # For JSON/CSV files

# Memory configuration
memory:
  device: "cuda"
  offload_device: "cpu"
  auto_offload: true

# Visualization configuration
visualization:
  save_dir: "./figures"
  dpi: 200
  show_legend: true
  
  # Output formats (complete report)
  output:
    formats: ["png", "html", "csv", "json"]
    report_name: "analysis_report"
    include_raw_data: true
  
  # Enabled visualizations
  enabled:
    magnitude_input: true
    magnitude_output: true
    magnitude_weight: true
    outlier_layer_wise: true
    outlier_position: true
    outlier_token: true
    heatmap_3d: true
    distribution: true
  
  # Magnitude configuration
  magnitude:
    components:
      - q_proj
      - o_proj
      - down_proj
      - up_proj
    reduce_dim: -1 # -1 for in-channel(cross token), -2 for token
    combined_plot: true
  
  # Outlier configuration
  outlier:
    threshold: 64  # Outlier threshold (relative to median)
    component_type: "down_proj"  # Component to analyze
    decode_tokens: true  # Whether to decode token content
  
  # Layer selection (supports regex)
  layer_selection:
    # Method 1: By component type - only specific layers
    components:
      q_proj: [0, 5, 10, 15, 20, 25]  # Only select specific layers
      o_proj: [0, 5, 10, 15, 20, 25]
      down_proj: [0, 5, 10, 15, 20, 25]
      up_proj: [0, 5, 10, 15, 20, 25]
    
    # Method 2: By regex patterns (commented out for testing)
    # patterns:
    #   - "layers\\.\\d+\\.mlp\\.down_proj"
    
    # Method 3: By range (commented out for testing)
    # ranges:
    #   - component: "self_attn"
    #     start: 0
    #     end: 10